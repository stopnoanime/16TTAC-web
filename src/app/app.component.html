<div class="flex gap-2 p-4 items-center">
  <button
    mat-flat-button
    color="primary"
    (click)="sim.compile(sourceCode); wasCompiled = true"
    [disabled]="sim.simRunning"
    matTooltip="Compile and load source code"
  >
    <mat-icon>build</mat-icon>
  </button>

  <button
    mat-flat-button
    color="primary"
    (click)="sim.reset()"
    [disabled]="!wasCompiled || sim.simRunning"
    matTooltip="Reset CPU"
  >
    <mat-icon>restart_alt</mat-icon>
  </button>

  <button
    mat-flat-button
    color="primary"
    (click)="sim.singleStep()"
    [disabled]="!wasCompiled || sim.simRunning"
    matTooltip="Single step CPU"
  >
    <mat-icon>skip_next</mat-icon>
  </button>

  <button
    mat-flat-button
    color="primary"
    (click)="sim.startStop()"
    [disabled]="!wasCompiled"
    [matTooltip]="sim.simRunning ? 'Stop CPU' : 'Run CPU'"
  >
    <mat-icon *ngIf="!sim.simRunning">play_arrow</mat-icon>
    <mat-icon *ngIf="sim.simRunning">stop</mat-icon>
  </button>

  <mat-slider
    min="1"
    max="60"
    value="1"
    thumbLabel
    color="primary"
    [displayWith]="formatSliderLabel"
    [disabled]="!wasCompiled || fullSpeed.checked"
    (input)="this.sim.simTimeout = 1000 / $event.value!"
  >
    <input matSliderThumb />
  </mat-slider>

  <mat-checkbox
    #fullSpeed
    color="primary"
    [disabled]="!wasCompiled"
    (change)="this.sim.fullSpeed = $event.checked"
    >Full speed</mat-checkbox
  >
</div>

<mat-form-field appearance="fill">
  <mat-label>Textarea</mat-label>
  <textarea
    matInput
    [(ngModel)]="sourceCode"
    (ngModelChange)="wasCompiled = false"
    [disabled]="sim.simRunning"
  ></textarea>
</mat-form-field>

<div class="whitespace-pre-line">
  outputBuffer:
  {{ sim.outputBuffer }}
</div>

<div class="font-thin">
  <div>Acc: {{ toHex(sim.acc) }}</div>
  <div>Adr: {{ toHex(sim.adr) }}</div>
  <div>Pc: {{ toHex(sim.pc) }}</div>
  <div>Carry Flag: {{ sim.carry ? "True" : "False" }}</div>
  <div>Zero Flag: {{ sim.zero ? "True" : "False" }}</div>
</div>
