<div
  class="grid h-screen"
  style="grid-template-columns: 1fr auto; grid-template-rows: auto 1fr 1fr auto"
>
  <div class="flex gap-3 p-4 items-center">
    <button
      mat-flat-button
      color="primary"
      (click)="compile()"
      [disabled]="sim.simRunning"
      matTooltip="Compile and load source code"
    >
      <mat-icon class="min-w-fit">build</mat-icon>
      Compile
    </button>

    <button
      mat-flat-button
      color="primary"
      (click)="sim.reset()"
      [disabled]="!wasCompiled || sim.simRunning"
      matTooltip="Reset CPU"
    >
      <mat-icon class="min-w-fit">restart_alt</mat-icon>
      Restart
    </button>

    <button
      mat-flat-button
      color="primary"
      (click)="sim.singleStep()"
      [disabled]="!wasCompiled || sim.simRunning"
      matTooltip="Single step CPU"
    >
      <mat-icon class="min-w-fit">skip_next</mat-icon>
      Single step
    </button>

    <button
      mat-flat-button
      color="primary"
      (click)="sim.startStop()"
      [disabled]="!wasCompiled"
      [matTooltip]="sim.simRunning ? 'Stop CPU' : 'Run CPU'"
    >
      <mat-icon class="min-w-fit" *ngIf="!sim.simRunning">play_arrow</mat-icon>
      <span *ngIf="!sim.simRunning">Start</span>

      <mat-icon class="min-w-fit" *ngIf="sim.simRunning">stop</mat-icon>
      <span *ngIf="sim.simRunning">Stop</span>
    </button>

    <span>CPU speed:</span>
    <mat-slider
      min="1"
      max="60"
      value="1"
      discrete
      color="primary"
      [displayWith]="formatSliderLabel"
      [disabled]="!wasCompiled || fullSpeed.checked"
    >
      <input
        matSliderThumb
        (valueChange)="this.sim.simTimeout = 1000 / $event"
      />
    </mat-slider>

    <mat-checkbox
      #fullSpeed
      color="primary"
      [disabled]="!wasCompiled"
      (change)="this.sim.fullSpeed = $event.checked"
      >Full speed</mat-checkbox
    >
  </div>

  <app-code-editor
    class="col-start-1 row-span-2"
    [disabled]="sim.simRunning"
    [compiled]="wasCompiled"
    [parserOutput]="parserOutput"
    [(sourceCode)]="sourceCode"
    (sourceCodeChange)="wasCompiled = false"
    [highlightBlue]="sim.simProp.adr"
    [highlightGreen]="sim.simProp.pc"
    [highlightPurple]="memoryViewerHoveredAddress"
    (hoveredAddressChange)="sourceCodeHoveredAddress = $event"
  ></app-code-editor>

  <div class="font-thin">
    <div>Acc: {{ toHex(sim.simProp.acc) }}</div>
    <div class="text-blue-500">Adr: {{ toHex(sim.simProp.adr) }}</div>
    <div class="text-green-500">Pc: {{ toHex(sim.simProp.pc) }}</div>
    <div>Pc: {{ toHex(sim.simProp.stackPointer) }}</div>
    <div>Carry Flag: {{ sim.simProp.carry ? "True" : "False" }}</div>
    <div>Zero Flag: {{ sim.simProp.zero ? "True" : "False" }}</div>
  </div>

  <div class="flex gap-2 p-2">
    <app-memory-viewer
      [uint16Array]="sim.simProp.memory"
      [blockSize]="64"
      [highlightBlue]="sim.simProp.adr"
      [highlightGreen]="sim.simProp.pc"
      [highlightPurple]="sourceCodeHoveredAddress"
      (hoveredAddressChange)="memoryViewerHoveredAddress = $event"
    ></app-memory-viewer>

    <app-memory-viewer
      [uint16Array]="sim.simProp.stack"
      [blockSize]="16"
      [wordsPerRow]="1"
      [maxAddress]="256"
      [label]="'Stack viewer'"
      [highlightBlue]="sim.simProp.stackPointer"
    ></app-memory-viewer>
  </div>

  <app-terminal
    class="h-80 col-span-2"
    [output]="sim.output"
    (input)="sim.input = $event"
  ></app-terminal>
</div>
